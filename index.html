<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#4F46E5">
    <title>ColorHelper FINAL</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, sans-serif;
            background: #f9fafb;
            touch-action: pan-y;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }
        button { 
            border: none;
            cursor: pointer;
            touch-action: manipulation;
            transition: transform 0.1s;
            -webkit-appearance: none;
        }
        button:active { transform: scale(0.96); }
        .container { max-width: 28rem; margin: 0 auto; }
        
        /* Header */
        .header {
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-bottom: 3px solid #4F46E5;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .header-inner {
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo {
            width: 3rem;
            height: 3rem;
            background: #4F46E5;
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        .title {
            font-size: 1.25rem;
            font-weight: 900;
            color: #111;
        }
        
        /* Tabs */
        .tabs {
            background: white;
            border-bottom: 3px solid #D1D5DB;
            position: sticky;
            top: 73px;
            z-index: 90;
        }
        .tabs-inner {
            padding: 0.5rem;
            display: flex;
            gap: 0.5rem;
        }
        .tab {
            flex: 1;
            padding: 0.875rem 0.5rem;
            border: 3px solid #D1D5DB;
            border-radius: 0.75rem;
            background: #F3F4F6;
            color: #374151;
            font-weight: 700;
            font-size: 0.875rem;
            text-align: center;
        }
        .tab.active {
            background: #4F46E5;
            color: white;
            border-color: #3730A3;
            box-shadow: 0 2px 4px rgba(79, 70, 229, 0.3);
        }
        
        /* Content */
        .content {
            padding: 1rem;
            padding-bottom: 8rem;
        }
        .page {
            display: none;
        }
        .page.active {
            display: block;
            animation: fadeIn 0.2s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Card */
        .card {
            background: white;
            border-radius: 1.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.07);
            border: 3px solid #E5E7EB;
            margin-bottom: 1rem;
            overflow: hidden;
        }
        .card-body {
            padding: 1.5rem;
        }
        
        /* Video */
        .video-box {
            position: relative;
            height: 20rem;
            background: linear-gradient(135deg, #E5E7EB, #D1D5DB);
            overflow: hidden;
        }
        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            background: #000;
        }
        .target {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 6rem;
            height: 6rem;
            pointer-events: none;
        }
        .target-outer {
            width: 100%;
            height: 100%;
            border: 6px solid #000;
            border-radius: 50%;
            position: relative;
        }
        .target-inner {
            position: absolute;
            top: 6px;
            left: 6px;
            right: 6px;
            bottom: 6px;
            border: 6px solid #fff;
            border-radius: 50%;
        }
        
        /* Buttons */
        .btn {
            width: 100%;
            padding: 1.25rem;
            border-radius: 1rem;
            font-weight: 900;
            font-size: 1.125rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }
        .btn-primary {
            background: #4F46E5;
            color: white;
            border: 3px solid #3730A3;
            box-shadow: 0 4px 6px rgba(79, 70, 229, 0.3);
        }
        .btn-success {
            background: #10B981;
            color: white;
            border: 3px solid #059669;
            box-shadow: 0 4px 6px rgba(16, 185, 129, 0.3);
            padding: 1.5rem;
            font-size: 1.25rem;
        }
        .btn-secondary {
            background: #E5E7EB;
            color: #374151;
            border: 3px solid #D1D5DB;
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Color Display */
        .color-display {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .color-swatch {
            width: 8rem;
            height: 8rem;
            border-radius: 1.5rem;
            border: 4px solid #9CA3AF;
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
        }
        .color-info {
            flex: 1;
        }
        .color-name {
            font-size: 1.75rem;
            font-weight: 900;
            color: #111;
            margin-bottom: 0.5rem;
            line-height: 1.2;
        }
        .color-code {
            font-family: 'Courier New', monospace;
            font-weight: 700;
            background: #F3F4F6;
            padding: 0.5rem 0.75rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            display: inline-block;
            margin-bottom: 0.25rem;
        }
        
        /* Patterns - MORE VISIBLE */
        .pattern-dots::after {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle, rgba(0,0,0,0.6) 3px, transparent 3px);
            background-size: 18px 18px;
            pointer-events: none;
        }
        .pattern-stripes::after {
            content: '';
            position: absolute;
            inset: 0;
            background: repeating-linear-gradient(45deg, transparent, transparent 12px, rgba(0,0,0,0.5) 12px, rgba(0,0,0,0.5) 16px);
            pointer-events: none;
        }
        .pattern-grid::after {
            content: '';
            position: absolute;
            inset: 0;
            background: 
                linear-gradient(rgba(0,0,0,0.5) 2px, transparent 2px),
                linear-gradient(90deg, rgba(0,0,0,0.5) 2px, transparent 2px);
            background-size: 18px 18px;
            pointer-events: none;
        }
        .pattern-waves::after {
            content: '';
            position: absolute;
            inset: 0;
            background: repeating-linear-gradient(90deg, transparent, transparent 12px, rgba(0,0,0,0.5) 12px, rgba(0,0,0,0.5) 16px);
            pointer-events: none;
        }
        
        /* Info Grid */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            margin-top: 1rem;
        }
        .info-item {
            background: #F3F4F6;
            border: 2px solid #D1D5DB;
            border-radius: 0.75rem;
            padding: 0.75rem;
        }
        .info-label {
            font-size: 0.75rem;
            font-weight: 700;
            color: #6B7280;
            text-transform: uppercase;
            margin-bottom: 0.25rem;
        }
        .info-value {
            font-size: 1rem;
            font-weight: 900;
            color: #111;
        }
        
        /* Banner */
        .banner {
            background: linear-gradient(135deg, #E9D5FF, #FBE8FF);
            border: 4px solid #A855F7;
            border-radius: 1rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .banner-title {
            font-size: 1.25rem;
            font-weight: 900;
            color: #6B21A8;
            margin-bottom: 0.5rem;
        }
        .banner-text {
            font-size: 0.875rem;
            color: #7C3AED;
            font-weight: 600;
        }
        
        /* Compare Result */
        .result-box {
            padding: 2rem 1rem;
            border-radius: 1rem;
            text-align: center;
            font-size: 1.5rem;
            font-weight: 900;
            border: 4px solid;
        }
        .result-match {
            background: #FEE2E2;
            border-color: #DC2626;
            color: #7F1D1D;
        }
        .result-different {
            background: #D1FAE5;
            border-color: #10B981;
            color: #064E3B;
        }
        
        /* Notification */
        .toast {
            position: fixed;
            top: 1rem;
            left: 50%;
            transform: translateX(-50%);
            z-index: 200;
            background: white;
            border: 4px solid #10B981;
            border-radius: 1rem;
            padding: 1rem 1.5rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            display: none;
            align-items: center;
            gap: 0.75rem;
            max-width: 90%;
        }
        .toast.show {
            display: flex;
            animation: slideDown 0.3s ease;
        }
        @keyframes slideDown {
            from { transform: translate(-50%, -150%); opacity: 0; }
            to { transform: translate(-50%, 0); opacity: 1; }
        }
        .toast-icon {
            width: 2rem;
            height: 2rem;
            background: #10B981;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 1.25rem;
            flex-shrink: 0;
        }
        .toast-text {
            font-weight: 700;
            color: #047857;
        }
        
        .hide { display: none !important; }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="container header-inner">
            <div style="display: flex; align-items: center; gap: 0.75rem;">
                <div class="logo">üëÅÔ∏è</div>
                <div>
                    <div class="title">ColorHelper</div>
                    <div style="font-size: 0.75rem; color: #6B7280; font-weight: 600;">FINAL v5.0</div>
                </div>
            </div>
            <button id="soundToggle" style="padding: 0.75rem; background: #F3F4F6; border-radius: 0.75rem; border: 2px solid #D1D5DB; font-size: 1.5rem;">üîä</button>
        </div>
    </div>

    <!-- Tabs -->
    <div class="tabs">
        <div class="container tabs-inner">
            <button class="tab active" data-page="camera">üì∑ Camera</button>
            <button class="tab" data-page="compare">üîÑ ComparƒÉ</button>
            <button class="tab" data-page="saved">‚≠ê Salvate</button>
        </div>
    </div>

    <!-- Content -->
    <div class="container content">
        <!-- CAMERA PAGE -->
        <div id="cameraPage" class="page active">
            <!-- Compare Mode Banner -->
            <div id="compareBanner" class="banner hide">
                <div class="banner-title">üîÑ MOD COMPARARE ACTIV</div>
                <div id="bannerStatus" class="banner-text">PregƒÉtit sƒÉ detectez prima culoare</div>
            </div>

            <!-- Camera Card -->
            <div class="card">
                <div class="video-box">
                    <div id="videoPlaceholder" style="display: flex; align-items: center; justify-content: center; height: 100%; flex-direction: column; color: #6B7280;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">üì∑</div>
                        <div style="font-size: 1.25rem; font-weight: 700;">Porne»ôte camera</div>
                    </div>
                    <video id="videoElement" class="hide" autoplay playsinline muted></video>
                    <div id="targetCrosshair" class="target hide">
                        <div class="target-outer">
                            <div class="target-inner"></div>
                        </div>
                    </div>
                    <canvas id="canvasElement" style="display: none;"></canvas>
                </div>
                <div class="card-body">
                    <button id="btnStart" class="btn btn-primary">üì∑ PORNE»òTE CAMERA</button>
                    <div id="cameraControls" class="hide">
                        <button id="btnDetect" class="btn btn-success" disabled>üëÅÔ∏è DETECTEAZƒÇ CULOARE</button>
                        <button id="btnStop" class="btn btn-secondary">‚èπÔ∏è OPRE»òTE CAMERA</button>
                    </div>
                </div>
            </div>

            <!-- Color Result Card -->
            <div id="resultCard" class="card hide">
                <div class="card-body">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 style="font-size: 1.25rem; font-weight: 900;">üé® Culoare DetectatƒÉ</h3>
                        <button id="btnSave" style="padding: 0.75rem 1rem; background: #FBBF24; border: 3px solid #D97706; border-radius: 1rem; font-size: 1.5rem;">‚≠ê</button>
                    </div>
                    
                    <div class="color-display">
                        <div id="colorSwatch" class="color-swatch"></div>
                        <div class="color-info">
                            <div id="colorName" class="color-name">-</div>
                            <div id="colorHex" class="color-code">#000000</div>
                            <div id="colorRGB" style="font-size: 0.875rem; color: #6B7280; font-weight: 600; margin-top: 0.25rem;">RGB(0,0,0)</div>
                        </div>
                    </div>
                    
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Categorie</div>
                            <div id="infoCategory" class="info-value">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Luminozitate</div>
                            <div id="infoBrightness" class="info-value">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Satura»õie</div>
                            <div id="infoSaturation" class="info-value">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">TemperaturƒÉ</div>
                            <div id="infoTemp" class="info-value">-</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- COMPARE PAGE -->
        <div id="comparePage" class="page">
            <div class="card" style="background: linear-gradient(135deg, #E9D5FF, #FBE8FF); border-color: #A855F7;">
                <div class="card-body">
                    <h2 style="font-size: 1.75rem; font-weight: 900; margin-bottom: 1rem; color: #6B21A8;">üîÑ ComparƒÉ Culori</h2>
                    <p style="font-size: 1rem; margin-bottom: 1rem; color: #7C3AED; font-weight: 600;">VerificƒÉ dacƒÉ hainele tale se potrivesc!</p>
                    <div style="background: rgba(255,255,255,0.8); padding: 1rem; border-radius: 1rem; font-size: 0.875rem; color: #581C87; font-weight: 600;">
                        <strong style="display: block; margin-bottom: 0.5rem; color: #6B21A8;">üìã Pa»ôi simpli:</strong>
                        <div style="line-height: 1.8;">
                        1Ô∏è‚É£ ApasƒÉ tab <strong>CAMERA</strong><br>
                        2Ô∏è‚É£ Porne»ôte camera<br>
                        3Ô∏è‚É£ DetecteazƒÉ <strong>prima culoare</strong> (ex: tricou)<br>
                        4Ô∏è‚É£ DetecteazƒÉ <strong>a doua culoare</strong> (ex: pantalon)<br>
                        5Ô∏è‚É£ Revino aici pentru <strong>rezultat</strong>!
                        </div>
                    </div>
                </div>
            </div>

            <div id="compareList"></div>
            
            <div id="compareResult" class="card hide">
                <div class="card-body">
                    <h3 style="font-size: 1.5rem; font-weight: 900; margin-bottom: 1rem;">üìä Rezultat Comparare</h3>
                    <div id="resultDisplay"></div>
                </div>
            </div>

            <button id="btnReset" class="btn btn-secondary">üîÑ √éNCEPE DIN NOU</button>
        </div>

        <!-- SAVED PAGE -->
        <div id="savedPage" class="page">
            <div id="savedEmpty" class="card">
                <div style="text-align: center; padding: 4rem 1rem;">
                    <div style="font-size: 5rem; margin-bottom: 1rem;">‚≠ê</div>
                    <h3 style="font-size: 1.5rem; font-weight: 900; margin-bottom: 0.75rem; color: #111;">Nicio culoare salvatƒÉ</h3>
                    <p style="color: #6B7280; font-weight: 600;">DetecteazƒÉ culori »ôi salveazƒÉ-le apƒÉs√¢nd ‚≠ê</p>
                </div>
            </div>
            
            <div id="savedList" class="card hide">
                <div class="card-body">
                    <h3 style="font-size: 1.25rem; font-weight: 900; margin-bottom: 1rem;">‚≠ê Culori Salvate (<span id="savedCount">0</span>)</h3>
                    <div id="savedColors"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <div class="toast-icon">‚úì</div>
        <span id="toastText" class="toast-text"></span>
    </div>

    <script>
        'use strict';
        
        console.log('üé® ColorHelper FINAL v5.0 - Ultra Stable');

        // ============================================
        // STATE MANAGEMENT
        // ============================================
        const APP = {
            currentPage: 'camera',
            soundEnabled: true,
            videoStream: null,
            currentColor: null,
            savedColors: [],
            
            // COMPARE MODE STATE
            compareMode: false,
            compareColors: []
        };

        // ============================================
        // ELEMENTS
        // ============================================
        const EL = {
            // Video
            video: document.getElementById('videoElement'),
            canvas: document.getElementById('canvasElement'),
            placeholder: document.getElementById('videoPlaceholder'),
            crosshair: document.getElementById('targetCrosshair'),
            
            // Buttons
            btnStart: document.getElementById('btnStart'),
            btnStop: document.getElementById('btnStop'),
            btnDetect: document.getElementById('btnDetect'),
            btnSave: document.getElementById('btnSave'),
            btnReset: document.getElementById('btnReset'),
            soundToggle: document.getElementById('soundToggle'),
            
            // Controls
            controls: document.getElementById('cameraControls'),
            
            // Cards
            resultCard: document.getElementById('resultCard'),
            compareResult: document.getElementById('compareResult'),
            
            // Color Display
            colorSwatch: document.getElementById('colorSwatch'),
            colorName: document.getElementById('colorName'),
            colorHex: document.getElementById('colorHex'),
            colorRGB: document.getElementById('colorRGB'),
            infoCategory: document.getElementById('infoCategory'),
            infoBrightness: document.getElementById('infoBrightness'),
            infoSaturation: document.getElementById('infoSaturation'),
            infoTemp: document.getElementById('infoTemp'),
            
            // Compare
            compareBanner: document.getElementById('compareBanner'),
            bannerStatus: document.getElementById('bannerStatus'),
            compareList: document.getElementById('compareList'),
            resultDisplay: document.getElementById('resultDisplay'),
            
            // Saved
            savedEmpty: document.getElementById('savedEmpty'),
            savedList: document.getElementById('savedList'),
            savedColors: document.getElementById('savedColors'),
            savedCount: document.getElementById('savedCount'),
            
            // Toast
            toast: document.getElementById('toast'),
            toastText: document.getElementById('toastText')
        };

        // ============================================
        // COLOR CONVERSION - TESTED & VERIFIED
        // ============================================
        function rgbToHsl(r, g, b) {
            r /= 255;
            g /= 255;
            b /= 255;
            
            const max = Math.max(r, g, b);
            const min = Math.min(r, g, b);
            const delta = max - min;
            
            let h = 0;
            let s = 0;
            let l = (max + min) / 2;
            
            if (delta !== 0) {
                s = l > 0.5 ? delta / (2 - max - min) : delta / (max + min);
                
                if (max === r) {
                    h = ((g - b) / delta + (g < b ? 6 : 0)) / 6;
                } else if (max === g) {
                    h = ((b - r) / delta + 2) / 6;
                } else {
                    h = ((r - g) / delta + 4) / 6;
                }
            }
            
            return {
                h: Math.round(h * 360),
                s: Math.round(s * 100),
                l: Math.round(l * 100)
            };
        }

        // ============================================
        // COLOR ANALYSIS - ENHANCED
        // ============================================
        function analyzeColor(r, g, b) {
            const hsl = rgbToHsl(r, g, b);
            const hex = '#' + [r, g, b].map(x => ('0' + x.toString(16)).slice(-2)).join('');
            
            console.log(`üé® RGB(${r},${g},${b}) ‚Üí HSL(${hsl.h}¬∞,${hsl.s}%,${hsl.l}%)`);
            
            // CATEGORY - Check saturation FIRST
            let category, name, pattern;
            
            if (hsl.s < 12) {
                // Achromatic
                category = 'AcromaticƒÉ';
                pattern = '';
                
                if (hsl.l > 88) name = 'Alb';
                else if (hsl.l < 18) name = 'Negru';
                else if (hsl.l > 65) name = 'Gri deschis';
                else if (hsl.l > 40) name = 'Gri';
                else name = 'Gri √Ænchis';
            } else {
                // Chromatic - use hue
                const h = hsl.h;
                
                if (h < 15 || h >= 345) {
                    category = 'Ro»ôie';
                    name = 'Ro»ôu';
                    pattern = 'pattern-dots';
                } else if (h < 45) {
                    category = 'Portocalie';
                    name = 'Portocaliu';
                    pattern = 'pattern-dots';
                } else if (h < 70) {
                    category = 'GalbenƒÉ';
                    name = 'Galben';
                    pattern = 'pattern-grid';
                } else if (h < 165) {
                    category = 'Verde';
                    name = 'Verde';
                    pattern = 'pattern-stripes';
                } else if (h < 250) {
                    category = 'AlbastrƒÉ';
                    name = 'Albastru';
                    pattern = 'pattern-waves';
                } else if (h < 290) {
                    category = 'VioletƒÉ';
                    name = 'Violet';
                    pattern = 'pattern-waves';
                } else if (h < 330) {
                    category = 'Magenta';
                    name = 'Magenta';
                    pattern = 'pattern-grid';
                } else {
                    category = 'Roz';
                    name = 'Roz';
                    pattern = 'pattern-dots';
                }
            }
            
            // BRIGHTNESS
            let brightness;
            if (hsl.l > 75) brightness = 'Foarte luminoasƒÉ';
            else if (hsl.l > 55) brightness = 'LuminoasƒÉ';
            else if (hsl.l > 35) brightness = 'Medie';
            else if (hsl.l > 20) brightness = '√éntunecatƒÉ';
            else brightness = 'Foarte √ÆntunecatƒÉ';
            
            // SATURATION LEVEL
            let saturationLevel;
            if (hsl.s < 12) saturationLevel = 'NeutrƒÉ';
            else if (hsl.s < 35) saturationLevel = 'SlabƒÉ';
            else if (hsl.s < 65) saturationLevel = 'Medie';
            else if (hsl.s < 85) saturationLevel = 'PuternicƒÉ';
            else saturationLevel = 'Foarte puternicƒÉ';
            
            // TEMPERATURE
            let temperature;
            if (hsl.s < 12) temperature = 'NeutrƒÉ';
            else if (r > b + 25) temperature = 'CaldƒÉ';
            else if (b > r + 25) temperature = 'Rece';
            else temperature = 'NeutrƒÉ';
            
            return {
                r, g, b,
                hex,
                hsl,
                name,
                category,
                pattern,
                brightness,
                saturation: saturationLevel,
                temperature,
                id: Date.now()
            };
        }

        // ============================================
        // NOTIFICATIONS
        // ============================================
        function notify(message) {
            console.log('üì¢', message);
            
            EL.toastText.textContent = message;
            EL.toast.classList.add('show');
            
            setTimeout(() => {
                EL.toast.classList.remove('show');
            }, 3000);
            
            // Sound
            if (APP.soundEnabled) {
                try {
                    const ctx = new (window.AudioContext || window.webkitAudioContext)();
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.connect(gain);
                    gain.connect(ctx.destination);
                    osc.frequency.value = 880;
                    gain.gain.setValueAtTime(0.2, ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.15);
                    osc.start();
                    osc.stop(ctx.currentTime + 0.15);
                } catch(e) {}
            }
            
            // Vibrate
            if (navigator.vibrate) {
                navigator.vibrate(50);
            }
        }

        // ============================================
        // CAMERA FUNCTIONS
        // ============================================
        async function startCamera() {
            console.log('‚ñ∂Ô∏è START CAMERA');
            
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: 'environment',
                        width: { ideal: 1920 },
                        height: { ideal: 1080 }
                    }
                });
                
                EL.video.srcObject = stream;
                APP.videoStream = stream;
                
                EL.video.onloadedmetadata = () => {
                    console.log('‚úÖ VIDEO READY');
                    EL.btnDetect.disabled = false;
                };
                
                // UI Updates
                EL.placeholder.classList.add('hide');
                EL.video.classList.remove('hide');
                EL.crosshair.classList.remove('hide');
                EL.btnStart.classList.add('hide');
                EL.controls.classList.remove('hide');
                EL.btnDetect.disabled = true;
                
                notify('Camera pornitƒÉ!');
                
            } catch (error) {
                console.error('‚ùå CAMERA ERROR:', error);
                notify('Eroare: Nu pot accesa camera!');
            }
        }

        function stopCamera() {
            console.log('‚èπÔ∏è STOP CAMERA');
            
            if (APP.videoStream) {
                APP.videoStream.getTracks().forEach(track => track.stop());
                APP.videoStream = null;
                EL.video.srcObject = null;
                
                // UI Updates
                EL.video.classList.add('hide');
                EL.crosshair.classList.add('hide');
                EL.placeholder.classList.remove('hide');
                EL.controls.classList.add('hide');
                EL.btnStart.classList.remove('hide');
                
                notify('Camera opritƒÉ');
            }
        }

        function detectColor() {
            console.log('üéØ DETECT COLOR');
            
            if (!EL.video.videoWidth || !EL.video.videoHeight) {
                notify('A»ôteaptƒÉ sƒÉ se √Æncarce camera...');
                return;
            }
            
            const ctx = EL.canvas.getContext('2d');
            EL.canvas.width = EL.video.videoWidth;
            EL.canvas.height = EL.video.videoHeight;
            ctx.drawImage(EL.video, 0, 0);
            
            const cx = Math.floor(EL.canvas.width / 2);
            const cy = Math.floor(EL.canvas.height / 2);
            
            // Sample 11x11 grid for accuracy
            let r = 0, g = 0, b = 0, count = 0;
            for (let dx = -5; dx <= 5; dx++) {
                for (let dy = -5; dy <= 5; dy++) {
                    const pixel = ctx.getImageData(cx + dx, cy + dy, 1, 1).data;
                    r += pixel[0];
                    g += pixel[1];
                    b += pixel[2];
                    count++;
                }
            }
            
            r = Math.round(r / count);
            g = Math.round(g / count);
            b = Math.round(b / count);
            
            const color = analyzeColor(r, g, b);
            
            console.log('‚úÖ DETECTED:', color.name);
            
            APP.currentColor = color;
            displayColor(color);
            
            // COMPARE MODE LOGIC
            if (APP.compareMode && APP.compareColors.length < 2) {
                APP.compareColors.push(color);
                console.log(`üìä Compare: ${APP.compareColors.length}/2 colors`);
                
                updateCompareBanner();
                updateComparePage();
                
                if (APP.compareColors.length === 1) {
                    notify('‚úÖ Prima culoare detectatƒÉ!');
                } else if (APP.compareColors.length === 2) {
                    notify('‚úÖ Ambele culori detectate! Vezi rezultatul √Æn tab ComparƒÉ');
                }
            } else {
                notify(`Detectat: ${color.name}`);
            }
        }

        function displayColor(color) {
            EL.colorSwatch.style.backgroundColor = color.hex;
            EL.colorSwatch.className = 'color-swatch ' + color.pattern;
            EL.colorName.textContent = color.name;
            EL.colorHex.textContent = color.hex;
            EL.colorRGB.textContent = `RGB(${color.r}, ${color.g}, ${color.b})`;
            EL.infoCategory.textContent = color.category;
            EL.infoBrightness.textContent = color.brightness;
            EL.infoSaturation.textContent = color.saturation;
            EL.infoTemp.textContent = color.temperature;
            
            EL.resultCard.classList.remove('hide');
        }

        // ============================================
        // COMPARE MODE FUNCTIONS
        // ============================================
        function updateCompareBanner() {
            if (!APP.compareMode) {
                EL.compareBanner.classList.add('hide');
                return;
            }
            
            EL.compareBanner.classList.remove('hide');
            
            const count = APP.compareColors.length;
            if (count === 0) {
                EL.bannerStatus.textContent = 'PregƒÉtit sƒÉ detectez prima culoare';
            } else if (count === 1) {
                EL.bannerStatus.textContent = '‚úÖ Prima culoare OK! DetecteazƒÉ a doua culoare';
            } else {
                EL.bannerStatus.textContent = '‚úÖ‚úÖ Ambele culori detectate! Vezi rezultatul √Æn tab ComparƒÉ';
            }
        }

        function updateComparePage() {
            console.log('üîÑ UPDATE COMPARE PAGE');
            
            const colors = APP.compareColors;
            
            if (colors.length === 0) {
                EL.compareList.innerHTML = '';
                EL.compareResult.classList.add('hide');
                return;
            }
            
            // Show color cards
            EL.compareList.innerHTML = colors.map((c, i) => `
                <div class="card">
                    <div class="card-body">
                        <div style="display: flex; gap: 1rem; align-items: center;">
                            <div class="color-swatch ${c.pattern}" style="background: ${c.hex}; width: 6rem; height: 6rem;"></div>
                            <div>
                                <div style="font-weight: 900; font-size: 1.25rem; margin-bottom: 0.25rem;">Culoare ${i + 1}</div>
                                <div style="font-size: 1.125rem; font-weight: 700; color: #4B5563; margin-bottom: 0.25rem;">${c.name}</div>
                                <div style="font-family: 'Courier New', monospace; font-weight: 600; color: #6B7280;">${c.hex}</div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            // Show result if 2 colors
            if (colors.length === 2) {
                const c1 = colors[0];
                const c2 = colors[1];
                
                // Compare by name AND category for better accuracy
                const sameName = c1.name === c2.name;
                const sameCategory = c1.category === c2.category;
                const match = sameName || sameCategory;
                
                console.log(`üìä COMPARE: ${c1.name} vs ${c2.name} = ${match ? 'MATCH' : 'DIFFERENT'}`);
                
                if (match) {
                    EL.resultDisplay.innerHTML = `
                        <div class="result-box result-match">
                            ‚ö†Ô∏è CULORI ASEMƒÇNƒÇTOARE<br>
                            <span style="font-size: 1rem; display: block; margin-top: 0.5rem;">Nu se potrivesc bine √ÆmpreunƒÉ</span>
                        </div>
                    `;
                } else {
                    EL.resultDisplay.innerHTML = `
                        <div class="result-box result-different">
                            ‚úÖ CULORI DIFERITE<br>
                            <span style="font-size: 1rem; display: block; margin-top: 0.5rem;">Se potrivesc perfect!</span>
                        </div>
                    `;
                }
                
                EL.compareResult.classList.remove('hide');
            } else {
                EL.compareResult.classList.add('hide');
            }
        }

        function resetCompare() {
            console.log('üîÑ RESET COMPARE');
            APP.compareColors = [];
            updateCompareBanner();
            updateComparePage();
            notify('Comparare resetatƒÉ');
        }

        // ============================================
        // SAVED COLORS
        // ============================================
        function saveColor() {
            if (!APP.currentColor) return;
            
            if (APP.savedColors.some(c => c.hex === APP.currentColor.hex)) {
                notify('Culoarea este deja salvatƒÉ!');
                return;
            }
            
            APP.savedColors.push(APP.currentColor);
            updateSavedPage();
            notify('Culoare salvatƒÉ!');
        }

        function deleteColor(id) {
            APP.savedColors = APP.savedColors.filter(c => c.id !== id);
            updateSavedPage();
            notify('Culoare »ôtearsƒÉ');
        }

        function updateSavedPage() {
            if (APP.savedColors.length === 0) {
                EL.savedEmpty.classList.remove('hide');
                EL.savedList.classList.add('hide');
            } else {
                EL.savedEmpty.classList.add('hide');
                EL.savedList.classList.remove('hide');
                EL.savedCount.textContent = APP.savedColors.length;
                
                EL.savedColors.innerHTML = APP.savedColors.map(c => `
                    <div style="display: flex; gap: 1rem; padding: 1rem; background: #F9FAFB; border-radius: 0.75rem; border: 2px solid #E5E7EB; margin-bottom: 0.75rem; align-items: center;">
                        <div class="color-swatch ${c.pattern}" style="background: ${c.hex}; width: 4rem; height: 4rem;"></div>
                        <div style="flex: 1;">
                            <div style="font-weight: 900; font-size: 1rem; margin-bottom: 0.25rem;">${c.name}</div>
                            <div style="font-family: 'Courier New', monospace; font-size: 0.875rem; color: #6B7280;">${c.hex}</div>
                        </div>
                        <button onclick="deleteColor(${c.id})" style="padding: 0.75rem; background: #FEE2E2; border: 2px solid #EF4444; border-radius: 0.75rem; font-size: 1.25rem;">‚ùå</button>
                    </div>
                `).join('');
            }
        }

        // Make deleteColor global
        window.deleteColor = deleteColor;

        // ============================================
        // PAGE SWITCHING
        // ============================================
        function switchPage(pageName) {
            console.log(`üìÑ SWITCH PAGE: ${pageName}`);
            
            APP.currentPage = pageName;
            
            // Update tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.page === pageName);
            });
            
            // Update pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageName + 'Page').classList.add('active');
            
            // COMPARE MODE LOGIC
            if (pageName === 'compare') {
                console.log('üîÑ ENTERING COMPARE MODE');
                APP.compareMode = true;
                APP.compareColors = []; // RESET on entering compare tab
                updateCompareBanner();
                updateComparePage();
            } else {
                console.log('‚ùå EXITING COMPARE MODE');
                APP.compareMode = false;
                updateCompareBanner();
            }
        }

        // ============================================
        // EVENT LISTENERS
        // ============================================
        EL.btnStart.onclick = startCamera;
        EL.btnStop.onclick = stopCamera;
        EL.btnDetect.onclick = detectColor;
        EL.btnSave.onclick = saveColor;
        EL.btnReset.onclick = resetCompare;
        
        EL.soundToggle.onclick = function() {
            APP.soundEnabled = !APP.soundEnabled;
            this.textContent = APP.soundEnabled ? 'üîä' : 'üîá';
            console.log('üîä Sound:', APP.soundEnabled);
        };
        
        document.querySelectorAll('.tab').forEach(tab => {
            tab.onclick = () => switchPage(tab.dataset.page);
        });

        // ============================================
        // INITIALIZATION
        // ============================================
        updateSavedPage();
        console.log('‚úÖ ColorHelper FINAL v5.0 - READY!');
        console.log('üìä State:', APP);
    </script>
</body>
</html>