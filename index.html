<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#4F46E5">
    <title>ColorHelper</title>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f9fafb;
            touch-action: pan-y;
            -webkit-tap-highlight-color: transparent;
        }
        button { 
            -webkit-appearance: none;
            border: none;
            cursor: pointer;
            touch-action: manipulation;
            transition: transform 0.15s ease;
        }
        button:active { transform: scale(0.95); }
        .container { max-width: 28rem; margin: 0 auto; }
        
        .header {
            background: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-bottom: 4px solid #4F46E5;
            position: sticky;
            top: 0;
            z-index: 40;
        }
        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
        }
        .header-left { display: flex; align-items: center; gap: 0.75rem; }
        .logo {
            width: 3rem;
            height: 3rem;
            background: #4F46E5;
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        .title { font-size: 1.25rem; font-weight: 900; color: #111; }
        .subtitle { font-size: 0.75rem; color: #6B7280; font-weight: 500; }
        
        .tabs {
            background: white;
            border-bottom: 4px solid #D1D5DB;
            position: sticky;
            top: 88px;
            z-index: 30;
        }
        .tabs-content { display: flex; gap: 0.5rem; padding: 0.5rem; }
        .tab {
            flex: 1;
            padding: 0.75rem 0.5rem;
            border: 3px solid #D1D5DB;
            border-radius: 0.75rem;
            background: #F3F4F6;
            color: #374151;
            font-weight: 700;
            font-size: 0.875rem;
            text-align: center;
            transition: all 0.2s ease;
        }
        .tab.active {
            background: #4F46E5;
            color: white;
            border-color: #3730A3;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .content { padding: 1rem; padding-bottom: 6rem; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .card {
            background: white;
            border-radius: 1.5rem;
            box-shadow: 0 10px 15px rgba(0,0,0,0.1);
            border: 4px solid #D1D5DB;
            overflow: hidden;
            margin-bottom: 1rem;
        }
        .card-body { padding: 1.5rem; }
        
        .video-container {
            position: relative;
            height: 20rem;
            background: linear-gradient(135deg, #E5E7EB, #D1D5DB);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            background: black;
        }
        .crosshair {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
        }
        .crosshair-outer {
            width: 6rem;
            height: 6rem;
            border: 8px solid black;
            border-radius: 50%;
        }
        .crosshair-inner {
            position: absolute;
            top: 8px;
            left: 8px;
            right: 8px;
            bottom: 8px;
            border: 8px solid white;
            border-radius: 50%;
        }
        .instruction {
            position: absolute;
            top: 1rem;
            left: 50%;
            transform: translateX(-50%);
            background: black;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            border: 4px solid white;
            font-weight: 900;
            pointer-events: none;
        }
        
        .btn {
            width: 100%;
            padding: 1.25rem;
            border-radius: 1rem;
            font-weight: 900;
            font-size: 1.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
        }
        .btn-primary {
            background: #4F46E5;
            color: white;
            border: 4px solid #3730A3;
            box-shadow: 0 10px 15px rgba(0,0,0,0.1);
        }
        .btn-success {
            background: #10B981;
            color: white;
            border: 4px solid #059669;
            box-shadow: 0 10px 15px rgba(0,0,0,0.1);
            padding: 1.5rem;
        }
        .btn-secondary {
            background: #D1D5DB;
            color: #1F2937;
            border: 4px solid #9CA3AF;
            padding: 0.75rem;
            font-size: 1.125rem;
        }
        .btn-small {
            padding: 0.75rem;
            width: auto;
            font-size: 1rem;
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* PATTERN-URI FOARTE VIZIBILE */
        .pattern-dots {
            position: relative;
        }
        .pattern-dots::after {
            content: '';
            position: absolute;
            inset: 0;
            background-image: radial-gradient(circle, rgba(0,0,0,0.4) 3px, transparent 3px);
            background-size: 15px 15px;
            pointer-events: none;
        }
        
        .pattern-grid {
            position: relative;
        }
        .pattern-grid::after {
            content: '';
            position: absolute;
            inset: 0;
            background-image: 
                linear-gradient(rgba(0,0,0,0.3) 2px, transparent 2px),
                linear-gradient(90deg, rgba(0,0,0,0.3) 2px, transparent 2px);
            background-size: 15px 15px;
            pointer-events: none;
        }
        
        .pattern-diagonal {
            position: relative;
        }
        .pattern-diagonal::after {
            content: '';
            position: absolute;
            inset: 0;
            background-image: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(0,0,0,0.3) 10px,
                rgba(0,0,0,0.3) 13px
            );
            pointer-events: none;
        }
        
        .pattern-vertical {
            position: relative;
        }
        .pattern-vertical::after {
            content: '';
            position: absolute;
            inset: 0;
            background-image: repeating-linear-gradient(
                90deg,
                transparent,
                transparent 10px,
                rgba(0,0,0,0.3) 10px,
                rgba(0,0,0,0.3) 13px
            );
            pointer-events: none;
        }
        
        .color-box {
            width: 7rem;
            height: 7rem;
            border-radius: 1.5rem;
            box-shadow: 0 10px 15px rgba(0,0,0,0.1);
            border: 4px solid #9CA3AF;
            flex-shrink: 0;
            overflow: hidden;
        }
        
        .compare-mode-banner {
            background: linear-gradient(135deg, #E9D5FF, #FBE8FF);
            border: 4px solid #A855F7;
            border-radius: 1rem;
            padding: 1rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }
        
        .info-box {
            background: #DBEAFE;
            border: 3px solid #3B82F6;
            border-radius: 0.75rem;
            padding: 0.75rem;
        }
        .info-label {
            font-size: 0.75rem;
            font-weight: 700;
            color: #1E40AF;
            margin-bottom: 0.25rem;
        }
        .info-value {
            font-size: 1rem;
            font-weight: 900;
            color: #1E3A8A;
        }
        
        .history-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: #F9FAFB;
            border-radius: 0.75rem;
            border: 2px solid #D1D5DB;
            margin-bottom: 0.5rem;
            cursor: pointer;
        }
        .history-box {
            width: 3.5rem;
            height: 3.5rem;
            border-radius: 0.75rem;
            border: 3px solid #9CA3AF;
            flex-shrink: 0;
            overflow: hidden;
        }
        
        .notification {
            position: fixed;
            top: 1rem;
            left: 50%;
            transform: translateX(-50%);
            z-index: 50;
            max-width: 90%;
            background: white;
            border-radius: 1rem;
            box-shadow: 0 20px 25px rgba(0,0,0,0.15);
            border: 4px solid #10B981;
            padding: 1rem 1.5rem;
            display: none;
            align-items: center;
            gap: 0.75rem;
        }
        .notification.show { display: flex; }
        .notification.error { border-color: #EF4444; }
        
        .hidden { display: none !important; }
        .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem; margin-top: 0.75rem; }
        .space-y { margin-bottom: 0.75rem; }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <div class="header-content">
                <div class="header-left">
                    <div class="logo">üëÅÔ∏è</div>
                    <div>
                        <div class="title">ColorHelper</div>
                        <div class="subtitle">Pentru daltonism</div>
                    </div>
                </div>
                <button id="soundBtn" class="btn btn-small btn-secondary">üîä</button>
            </div>
        </div>
    </div>

    <div class="tabs">
        <div class="container">
            <div class="tabs-content">
                <button class="tab active" data-tab="camera">üì∑ Camera</button>
                <button class="tab" data-tab="compare">üîÑ ComparƒÉ</button>
                <button class="tab" data-tab="saved">‚≠ê Salvate</button>
            </div>
        </div>
    </div>

    <div class="container content">
        <!-- Camera Tab -->
        <div id="cameraTab" class="tab-content active">
            <!-- Compare Mode Banner -->
            <div id="compareBanner" class="compare-mode-banner hidden">
                <div style="font-size: 1.125rem; margin-bottom: 0.25rem;">üîÑ MOD COMPARARE ACTIV</div>
                <div id="compareStatus" style="font-size: 0.875rem;">DetecteazƒÉ prima culoare</div>
            </div>

            <div class="card">
                <div class="video-container">
                    <div id="placeholderCamera" style="text-align: center; padding: 3rem;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">üì∑</div>
                        <p style="font-size: 1.125rem; font-weight: 900;">ApasƒÉ pentru camera</p>
                    </div>
                    <video id="video" class="hidden" autoplay playsinline muted></video>
                    <div id="crosshair" class="crosshair hidden">
                        <div class="crosshair-outer">
                            <div class="crosshair-inner"></div>
                        </div>
                    </div>
                    <div id="instruction" class="instruction hidden">CentreazƒÉ »õinta</div>
                    <canvas id="canvas" style="display:none;"></canvas>
                </div>
                <div class="card-body">
                    <button id="startCameraBtn" class="btn btn-primary">üì∑ PORNE»òTE CAMERA</button>
                    <div id="cameraControls" class="hidden">
                        <button id="detectBtn" class="btn btn-success space-y">üëÅÔ∏è DETECTEAZƒÇ CULOARE</button>
                        <button id="stopCameraBtn" class="btn btn-secondary">OPRE»òTE</button>
                    </div>
                </div>
            </div>

            <div id="detectedColorCard" class="card hidden">
                <div class="card-body">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 style="font-size: 1.25rem; font-weight: 900;">‚úÖ Culoare DetectatƒÉ</h3>
                        <button id="saveColorBtn" class="btn btn-small" style="background: #FBBF24; border: 4px solid #D97706; font-size: 1.5rem;">‚≠ê</button>
                    </div>
                    <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                        <div id="detectedColorBox" class="color-box"></div>
                        <div style="flex: 1;">
                            <div id="detectedColorName" style="font-size: 1.5rem; font-weight: 900; margin-bottom: 0.5rem;"></div>
                            <div id="detectedColorHex" style="font-family: monospace; font-weight: 700; background: #F3F4F6; padding: 0.5rem; border-radius: 0.5rem;"></div>
                        </div>
                    </div>
                    <div class="grid-2">
                        <div class="info-box">
                            <div class="info-label">CATEGORIE</div>
                            <div id="detectedCategory" class="info-value"></div>
                        </div>
                        <div class="info-box">
                            <div class="info-label">TEMPERATURƒÇ</div>
                            <div id="detectedTemp" class="info-value"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="historyCard" class="card hidden">
                <div class="card-body">
                    <h3 style="font-size: 1.125rem; font-weight: 900; margin-bottom: 1rem;">üìú Istoric Culori</h3>
                    <div id="historyList"></div>
                </div>
            </div>
        </div>

        <!-- Compare Tab -->
        <div id="compareTab" class="tab-content">
            <div class="card" style="background: linear-gradient(135deg, #E9D5FF, #FBE8FF); border-color: #A855F7;">
                <div class="card-body">
                    <h2 style="font-size: 1.5rem; font-weight: 900; margin-bottom: 0.75rem;">üîÑ Comparare Culori</h2>
                    <p style="font-size: 1rem; margin-bottom: 1rem;">Perfect pentru a verifica dacƒÉ hainele se potrivesc!</p>
                    <div style="background: rgba(255,255,255,0.7); padding: 1rem; border-radius: 1rem; font-size: 0.875rem;">
                        <strong style="display: block; margin-bottom: 0.5rem;">üìã Cum func»õioneazƒÉ:</strong>
                        <div>1Ô∏è‚É£ ApasƒÉ tab CAMERA</div>
                        <div>2Ô∏è‚É£ Porne»ôte camera</div>
                        <div>3Ô∏è‚É£ DetecteazƒÉ 2 culori diferite</div>
                        <div>4Ô∏è‚É£ Revino aici pentru rezultat!</div>
                    </div>
                </div>
            </div>

            <div id="compareList"></div>

            <div id="compareResult" class="card hidden">
                <div class="card-body">
                    <h3 style="font-size: 1.5rem; font-weight: 900; margin-bottom: 1rem;">üìä Rezultat</h3>
                    <div id="compareResultBox" style="padding: 1.5rem; border-radius: 1rem; text-align: center; font-size: 1.25rem; font-weight: 900;"></div>
                </div>
            </div>

            <button id="resetCompareBtn" class="btn btn-secondary">üîÑ RESETEAZƒÇ COMPARARE</button>
        </div>

        <!-- Saved Tab -->
        <div id="savedTab" class="tab-content">
            <div id="savedEmpty" class="card">
                <div style="text-align: center; padding: 3rem 1rem;">
                    <div style="font-size: 4rem; margin-bottom: 1rem;">‚≠ê</div>
                    <h3 style="font-size: 1.25rem; font-weight: 900; margin-bottom: 0.75rem;">Nicio culoare salvatƒÉ</h3>
                    <p style="margin-bottom: 1rem;">DetecteazƒÉ culori »ôi salveazƒÉ-le pentru acces rapid!</p>
                    <div style="background: #F3F4F6; padding: 1rem; border-radius: 1rem; font-size: 0.875rem; max-width: 300px; margin: 0 auto 1rem;">
                        <strong>Cum salvez?</strong><br>
                        DetecteazƒÉ o culoare, apoi apasƒÉ ‚≠ê
                    </div>
                </div>
            </div>

            <div id="savedList" class="card hidden">
                <div class="card-body">
                    <h3 style="font-size: 1.25rem; font-weight: 900; margin-bottom: 1rem;">‚≠ê Salvate (<span id="savedCount">0</span>)</h3>
                    <div id="savedColors"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="notification" class="notification">
        <div style="width: 2rem; height: 2rem; border-radius: 50%; background: #10B981; color: white; display: flex; align-items: center; justify-content: center; font-size: 1.25rem; font-weight: 900;">‚úì</div>
        <span id="notifText" style="font-weight: 700; color: #059669;"></span>
    </div>

    <script>
        console.log('üé® ColorHelper v3.0 Final');

        const state = {
            currentTab: 'camera',
            soundEnabled: true,
            cameraStream: null,
            detectedColor: null,
            colorHistory: [],
            savedColors: [],
            compareMode: false,
            compareColors: [],
            videoReady: false
        };

        const el = {
            video: document.getElementById('video'),
            canvas: document.getElementById('canvas')
        };

        function log(msg, data) {
            console.log(`[ColorHelper] ${msg}`, data || '');
        }

        function playSound(type = 'success') {
            if (!state.soundEnabled) return;
            try {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.frequency.value = type === 'success' ? 1000 : 600;
                gain.gain.setValueAtTime(0.3, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.15);
                osc.start();
                osc.stop(ctx.currentTime + 0.15);
            } catch(e) {}
        }

        function vibrate(type = 'success') {
            if ('vibrate' in navigator) {
                navigator.vibrate(type === 'success' ? [50, 50, 100] : [50]);
            }
        }

        function showNotification(msg, type = 'success') {
            log('Notification:', msg);
            const notif = document.getElementById('notification');
            const text = document.getElementById('notifText');
            text.textContent = msg;
            notif.className = 'notification show' + (type === 'error' ? ' error' : '');
            playSound(type);
            vibrate(type);
            setTimeout(() => notif.classList.remove('show'), 3000);
        }

        function rgbToHex(r, g, b) {
            return '#' + [r, g, b].map(x => ('0' + x.toString(16)).slice(-2)).join('');
        }

        function rgbToHsl(r, g, b) {
            r /= 255; g /= 255; b /= 255;
            const max = Math.max(r, g, b), min = Math.min(r, g, b);
            let h, s, l = (max + min) / 2;
            if (max === min) {
                h = s = 0;
            } else {
                const d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                switch (max) {
                    case r: h = ((g - b) / d + (g < b ? 6 : 0)) / 6; break;
                    case g: h = ((b - r) / d + 2) / 6; break;
                    case b: h = ((r - g) / d + 4) / 6; break;
                }
            }
            return { h: Math.round(h * 360), s: Math.round(s * 100), l: Math.round(l * 100) };
        }

        function getColorName(r, g, b) {
            const hsl = rgbToHsl(r, g, b);
            if (hsl.s < 10) {
                if (hsl.l > 95) return 'Alb';
                if (hsl.l < 5) return 'Negru';
                return 'Gri';
            }
            if (hsl.h < 30 || hsl.h > 330) return 'Ro»ôu';
            if (hsl.h < 75) return 'Galben';
            if (hsl.h < 150) return 'Verde';
            if (hsl.h < 260) return 'Albastru';
            return 'Violet';
        }

        function getPattern(r, g, b) {
            const hsl = rgbToHsl(r, g, b);
            if (hsl.s < 10) return '';
            if (hsl.h < 30 || hsl.h > 330) return 'pattern-dots';
            if (hsl.h < 75) return 'pattern-grid';
            if (hsl.h < 150) return 'pattern-diagonal';
            return 'pattern-vertical';
        }

        function getCategory(r, g, b) {
            const name = getColorName(r, g, b);
            if (name === 'Gri' || name === 'Alb' || name === 'Negru') return 'AcromaticƒÉ';
            return name;
        }

        function getTemperature(r, g, b) {
            if (r > b + 20) return 'CaldƒÉ';
            if (b > r + 20) return 'Rece';
            return 'NeutrƒÉ';
        }

        async function startCamera() {
            log('Starting camera...');
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'environment', width: { ideal: 1920 }, height: { ideal: 1080 } }
                });
                
                el.video.srcObject = stream;
                state.cameraStream = stream;
                state.videoReady = false;
                
                el.video.onloadedmetadata = () => {
                    log('Video ready');
                    state.videoReady = true;
                    document.getElementById('detectBtn').disabled = false;
                };
                
                document.getElementById('placeholderCamera').classList.add('hidden');
                el.video.classList.remove('hidden');
                document.getElementById('crosshair').classList.remove('hidden');
                document.getElementById('instruction').classList.remove('hidden');
                document.getElementById('startCameraBtn').classList.add('hidden');
                document.getElementById('cameraControls').classList.remove('hidden');
                document.getElementById('detectBtn').disabled = true;
                
                showNotification('Camera pornitƒÉ!');
            } catch (err) {
                log('Camera error:', err);
                showNotification('Nu pot accesa camera', 'error');
            }
        }

        function stopCamera() {
            if (state.cameraStream) {
                state.cameraStream.getTracks().forEach(t => t.stop());
                state.cameraStream = null;
                el.video.srcObject = null;
                state.videoReady = false;
                
                el.video.classList.add('hidden');
                document.getElementById('crosshair').classList.add('hidden');
                document.getElementById('instruction').classList.add('hidden');
                document.getElementById('placeholderCamera').classList.remove('hidden');
                document.getElementById('cameraControls').classList.add('hidden');
                document.getElementById('startCameraBtn').classList.remove('hidden');
            }
        }

        function detectColor() {
            if (!state.videoReady || !el.video.videoWidth) {
                showNotification('A»ôteaptƒÉ camera...', 'error');
                return;
            }
            
            const ctx = el.canvas.getContext('2d');
            el.canvas.width = el.video.videoWidth;
            el.canvas.height = el.video.videoHeight;
            ctx.drawImage(el.video, 0, 0);
            
            const cx = Math.floor(el.canvas.width / 2);
            const cy = Math.floor(el.canvas.height / 2);
            let r = 0, g = 0, b = 0, count = 0;
            
            for (let dx = -8; dx <= 8; dx++) {
                for (let dy = -8; dy <= 8; dy++) {
                    const data = ctx.getImageData(cx + dx, cy + dy, 1, 1).data;
                    r += data[0]; g += data[1]; b += data[2]; count++;
                }
            }
            
            r = Math.round(r / count);
            g = Math.round(g / count);
            b = Math.round(b / count);
            
            const color = {
                r, g, b,
                hex: rgbToHex(r, g, b),
                name: getColorName(r, g, b),
                pattern: getPattern(r, g, b),
                category: getCategory(r, g, b),
                temperature: getTemperature(r, g, b),
                id: Date.now()
            };
            
            log('Detected:', color);
            
            state.detectedColor = color;
            state.colorHistory.unshift(color);
            state.colorHistory = state.colorHistory.slice(0, 10);
            
            if (state.compareMode && state.compareColors.length < 2) {
                state.compareColors.push(color);
                updateCompareBanner();
                updateCompareTab();
                
                if (state.compareColors.length === 1) {
                    showNotification('Prima culoare OK! DetecteazƒÉ a doua');
                } else {
                    showNotification('Ambele detectate! Mergi la tab ComparƒÉ');
                }
            } else {
                showNotification(`Detectat: ${color.name}`);
            }
            
            updateDetectedColor();
            updateHistory();
        }

        function updateDetectedColor() {
            if (!state.detectedColor) return;
            const c = state.detectedColor;
            
            const box = document.getElementById('detectedColorBox');
            box.style.backgroundColor = c.hex;
            box.className = 'color-box ' + c.pattern;
            
            document.getElementById('detectedColorName').textContent = c.name;
            document.getElementById('detectedColorHex').textContent = c.hex;
            document.getElementById('detectedCategory').textContent = c.category;
            document.getElementById('detectedTemp').textContent = c.temperature;
            document.getElementById('detectedColorCard').classList.remove('hidden');
        }

        function updateHistory() {
            if (state.colorHistory.length === 0) return;
            
            const html = state.colorHistory.slice(0, 5).map((c, i) => `
                <div class="history-item" data-idx="${i}">
                    <div class="history-box ${c.pattern}" style="background-color: ${c.hex}"></div>
                    <div style="flex: 1;">
                        <div style="font-weight: 900; font-size: 0.875rem;">${c.name}</div>
                        <div style="font-family: monospace; font-size: 0.75rem; color: #6B7280;">${c.hex}</div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('historyList').innerHTML = html;
            document.getElementById('historyCard').classList.remove('hidden');
            
            document.querySelectorAll('[data-idx]').forEach(el => {
                el.addEventListener('click', function() {
                    state.detectedColor = state.colorHistory[parseInt(this.dataset.idx)];
                    updateDetectedColor();
                });
            });
        }

        function updateCompareBanner() {
            const banner = document.getElementById('compareBanner');
            const status = document.getElementById('compareStatus');
            
            if (!state.compareMode) {
                banner.classList.add('hidden');
                return;
            }
            
            banner.classList.remove('hidden');
            const count = state.compareColors.length;
            
            if (count === 0) {
                status.textContent = 'DetecteazƒÉ prima culoare';
            } else if (count === 1) {
                status.textContent = '‚úÖ Prima culoare OK! DetecteazƒÉ a doua';
            } else {
                status.textContent = '‚úÖ‚úÖ Ambele culori detectate! Mergi la tab ComparƒÉ';
            }
        }

        function updateCompareTab() {
            const list = document.getElementById('compareList');
            const result = document.getElementById('compareResult');
            const resultBox = document.getElementById('compareResultBox');
            
            if (state.compareColors.length === 0) {
                list.innerHTML = '';
                result.classList.add('hidden');
            } else if (state.compareColors.length === 1) {
                const c = state.compareColors[0];
                list.innerHTML = `
                    <div class="card">
                        <div class="card-body">
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <div class="color-box ${c.pattern}" style="background-color: ${c.hex}; width: 5rem; height: 5rem;"></div>
                                <div>
                                    <div style="font-weight: 900; font-size: 1.125rem;">Culoare 1: ${c.name}</div>
                                    <div style="font-family: monospace; font-size: 0.875rem;">${c.hex}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                result.classList.add('hidden');
            } else {
                list.innerHTML = state.compareColors.map((c, i) => `
                    <div class="card">
                        <div class="card-body">
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <div class="color-box ${c.pattern}" style="background-color: ${c.hex}; width: 5rem; height: 5rem;"></div>
                                <div>
                                    <div style="font-weight: 900; font-size: 1.125rem;">Culoare ${i + 1}: ${c.name}</div>
                                    <div style="font-family: monospace; font-size: 0.875rem;">${c.hex}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
                
                const similar = state.compareColors[0].name === state.compareColors[1].name || 
                               state.compareColors[0].category === state.compareColors[1].category;
                
                if (similar) {
                    resultBox.style.background = '#FEE2E2';
                    resultBox.style.border = '4px solid #EF4444';
                    resultBox.style.color = '#991B1B';
                    resultBox.textContent = '‚ö†Ô∏è CULORI FOARTE ASEMƒÇNƒÇTOARE - Nu se potrivesc bine!';
                } else {
                    resultBox.style.background = '#D1FAE5';
                    resultBox.style.border = '4px solid #10B981';
                    resultBox.style.color = '#065F46';
                    resultBox.textContent = '‚úÖ CULORI DIFERITE - Se potrivesc perfect!';
                }
                
                result.classList.remove('hidden');
            }
        }

        function saveCurrentColor() {
            if (!state.detectedColor) return;
            if (state.savedColors.some(c => c.hex === state.detectedColor.hex)) {
                showNotification('Deja salvatƒÉ!', 'error');
                return;
            }
            state.savedColors.push(state.detectedColor);
            updateSavedTab();
            showNotification('Culoare salvatƒÉ!');
        }

        function updateSavedTab() {
            const empty = document.getElementById('savedEmpty');
            const list = document.getElementById('savedList');
            
            if (state.savedColors.length === 0) {
                empty.classList.remove('hidden');
                list.classList.add('hidden');
            } else {
                empty.classList.add('hidden');
                list.classList.remove('hidden');
                document.getElementById('savedCount').textContent = state.savedColors.length;
                
                document.getElementById('savedColors').innerHTML = state.savedColors.map(c => `
                    <div class="history-item">
                        <div class="history-box ${c.pattern}" style="background-color: ${c.hex}"></div>
                        <div style="flex: 1;">
                            <div style="font-weight: 900; font-size: 0.875rem;">${c.name}</div>
                            <div style="font-family: monospace; font-size: 0.75rem; color: #6B7280;">${c.hex}</div>
                        </div>
                        <button class="btn btn-small delete-btn" data-id="${c.id}" style="background: #FEE2E2; border: 2px solid #EF4444; padding: 0.5rem; font-size: 1.25rem;">‚ùå</button>
                    </div>
                `).join('');
                
                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const id = parseInt(this.dataset.id);
                        state.savedColors = state.savedColors.filter(c => c.id !== id);
                        updateSavedTab();
                        showNotification('Culoare »ôtearsƒÉ');
                    });
                });
            }
        }

        function switchTab(tabName) {
            log('Switch to:', tabName);
            state.currentTab = tabName;
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.tab === tabName);
            });
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            if (tabName === 'compare') {
                state.compareMode = true;
                if (state.compareColors.length === 0) {
                    state.compareColors = [];
                }
                updateCompareBanner();
                updateCompareTab();
            } else {
                state.compareMode = false;
                updateCompareBanner();
            }
        }

        // Event Listeners
        document.getElementById('startCameraBtn').addEventListener('click', startCamera);
        document.getElementById('stopCameraBtn').addEventListener('click', stopCamera);
        document.getElementById('detectBtn').addEventListener('click', detectColor);
        document.getElementById('saveColorBtn').addEventListener('click', saveCurrentColor);
        document.getElementById('resetCompareBtn').addEventListener('click', () => {
            state.compareColors = [];
            updateCompareBanner();
            updateCompareTab();
            showNotification('Comparare resetatƒÉ');
        });

        document.getElementById('soundBtn').addEventListener('click', function() {
            state.soundEnabled = !state.soundEnabled;
            this.textContent = state.soundEnabled ? 'üîä' : 'üîá';
        });

        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                switchTab(this.dataset.tab);
            });
        });

        updateSavedTab();
        log('‚úÖ Initialized!');
    </script>
</body>
</html>